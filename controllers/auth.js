 const {StatusCodes}=require('http-status-codes')
 const User=require('../models/User')
 const bcrypt=require('bcryptjs')

 const register = async (req, res) => {
    const { username, email, password } = req.body;

    const salt = await bcrypt.genSalt(10);
    const hashedPassword = await bcrypt.hash(password, salt);

    const tempUser = { username, email, password: hashedPassword };

    const user = await User.create({ ...tempUser });
    const token = user.createJWT(); // Call the instance method here

    res.status(StatusCodes.CREATED).json({ user, token });
};

const login = async (req, res) => {
    const { username, email, password } = req.body;

    if (!username || !email || !password) {
        return res
            .status(400)
            .json({ msg: `Please provide username, email, and password` });
    }

    const user = await User.findOne({ email });
    if (!user) {
        return res
            .status(401)  //unauthentication 
            .json({ msg: `Email not registered, please register first` });
    }

    if (user.username !== username) {
        return res
            .status(401) //unauthentication 
            .json({ msg: `Username not registered with this email` });
    }

    const ispassword=await bcrypt.compare(password,user.password)

    if (!ispassword) {
        return res
            .status(401) //unauthentication
            .json({ msg: `Password incorrect` });
    }

    const token = user.createJWT();
    return res
        .status(200)
        .json({ msg: `Login successful`, token });
};


module.exports={register,login}


































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































